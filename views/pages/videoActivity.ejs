<!-- views/pages/index.ejs -->

<!DOCTYPE html>
<html lang="fr">
    <head>
        <% include ../partials/head.ejs %>
    </head>
    <body class="bg-dark">
        <% include ../../public/lib/js/chat/chat.ejs %>
        <main class="container-fluid h-100 col p-0 m-0">
            <% include ../partials/headbandVideo.ejs %>
            <% include ../partials/navbar.ejs %>
            <h2 class="title py-2 text-center"><%= params.video.title %></h2>
            <div class="container-fluid bodyPage col-md-12 p-2 m-0"> 
                <div id="themeVideo" class="container-fluid col-md-11 p-0 mx-auto">
                </div>
                <div id="infoVideo" class="container-fluid justify-content-between row col-md-11 p-0 my-2 mx-auto">
                    <div class="infos container col-md-3">
                        <div class="container row p-0 m-0">
                            <p class="publishedAt">Posté le <%= params.video.date %></p>
                        </div>
                        <div class="container p-0 m-0">
                            <%= params.video.description1 %>
                        </div>
                    </div>
                    <div class="comments container col-md-9">
                        <h2 class="yourComments">Vos commentaires YouTube</h2>
                        <h1><%= params.video.theme %></h1>
                        <div  class="container-fluid col justify-content-start p-0 m-0">
                            <% params.video.comments.forEach(function(p) { %>
                            <div class="container-fluid row justify-content-start p-0 m-0">
                                <div class="container-fluid col col-md-1 p-0 m-0">
                                    <img src ="<%= p.avatar %>" />
                                    <p class="author p-0 m-0"><%= p.author %></p>
                                </div>
                                <p class="adit container-fluid col-md-2 p-0 m-0">a écrit :</p>
                                <div class="container-fluid col-md-9 p-0 m-0">
                                    <p><%= p.text %></p>
                                    <p class="container-fluid row justify-content-end"><small ><%= p.date %></small></p>
                                </div>
                            </div>
                            <% }); %>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="container container col h-25 p-0 m-0">
                <% include ../partials/footer.ejs %>
            </footer>
            <div id="hidden" class="hidden"><%= JSON.stringify(params.video) %></div>
        </main>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
        <script src="https://apis.google.com/js/platform.js"></script>
        <script src="/socket.io/socket.io.js"></script>
          <script src="/public/lib/js/chat/chat.js"></script>
        <link rel="stylesheet" href="../../public/lib/js/themeChannel/themeChannel.css" />
        <link rel="stylesheet" href="../../public/lib/js/chat/chat.css" />
        <% include ../../public/lib/js/themeChannel/themeChannel.ejs %>
        <script>
// Appel de la classe Theme (de themeChannel.ejs) qui met en place le theme (prepend dans #themeVideo) et a un css propre en fonction du theme
             new Theme ('<%= params.theme %>');
              myParam = {
             pseudo: '<%= params.myParam.pseudo %>',
             chatOptions: {
                 color: '<%= params.myParam.chatOptions.color %>',
                 style: '<%= params.myParam.chatOptions.style %>'
             },
             socket: {
                 id: '<%= params.myParam.socket.id %>'
             }
         };
         socket = io.connect ();
         if (myParam.pseudo !== 'undefined' && myParam.pseudo !== '')
             {
                 startChat ();
             }
         function startChat () {
             socket = io({'forceNew': true});
             chatLoginHTML = document.getElementById ('chatLogin');
             console.log ('myParam recu : ');
             console.log (myParam);
             if (myParam.pseudo === 'undefined' || myParam.pseudo === '')
                 {
                     myParam = {
                         pseudo: '',
                         chatOptions: {
                             color: 'black',
                             style: 1
                         },
                         socket: {
                             id: socket.id
                         }
                     };
                 }
             chatClient ();
             chatLoginHTML.style.display = 'flex';
             setTimeout (function () {
                 chatLoginHTML.classList.add ('chatActif');
             }, 20);
         }
         ;
         var chatButtonStart = document.getElementById ('chatButtonStart');
         chatButtonStart.onclick = function () {
             startChat ();
         };
        </script>
        <script src="/public/assets/js/navbar.js"></script>
        <script src="/public/assets/js/activity.js"></script>
        <script>
             function execute_YTvideo () {
                 return youtube.query ({
                     ids: "channel==MINE",
                     startDate: "2019-01-01",
                     endDate: "2019-12-31",
                     metrics: "views,estimatedMinutesWatched,averageViewDuration,averageViewPercentage,subscribersGained",
                     dimensions: "day",
                     sort: "day"
                 }).then (function (e) {}, function (e) {
                     console.error ("Execute error", e);
                 });
             }
             ;
        </script>
    </body>
</html>


